<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta name="description" content="Bos Gaurus - Built for Impact. Gear for athletes, rebels, and relentless movers. Enter the BosVerse.">
<meta property="og:title" content="Bos Gaurus">
  <meta property="og:image" content="Adobe Express - file.png">

<meta property="og:description" content="Born for Impact. Built to Dominate.">
<meta property="og:type" content="website">

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="BOS" />
<link rel="manifest" href="/site.webmanifest" />

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bos Gaurus</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dopamine-orange {
      color: #ED944D;
    }
    .dopamine-bg {
      background-color: #ED944D;
    }
    .no-radius * {
      border-radius: 0 !important;
    }

    /* Glitch Animation */
    .glitch {
      position: relative;
      color: white;
      animation: glitch 1s infinite;
    }

    @keyframes glitch {
      0% {text-shadow: 2px 2px #ED944D;}
      20% {text-shadow: -2px -2px #ED944D;}
      40% {text-shadow: 2px -2px #ED944D;}
      60% {text-shadow: -2px 2px #ED944D;}
      80% {text-shadow: 1px 1px #ED944D;}
      100% {text-shadow: 0 0 #ED944D;}
    }
  </style>
</head>

<body class="bg-black text-white font-mono no-radius">
     
<!-- Navigation Header -->
<header class="bg-white text-black px-6 py-4 flex justify-between items-center sticky top-0 z-50 border-b border-gray-700">
  <!-- Logo -->
  <div class="flex items-center">
    <img src="Adobe Express - file.png" alt="Bos Gaurus Logo" class="h-8 w-auto mr-2">
  </div>

  <!-- Desktop Navigation -->
  <nav class="hidden md:flex space-x-6 text-sm font-bold uppercase tracking-wide">
    <a href="#about" class="hover:text-gray-400 transition">About Us</a>
    <a href="contact.html" class="hover:text-gray-400 transition">Contact Us</a>
  </nav>

  <!-- Hamburger Menu Button (Mobile only) -->
  <button id="menu-btn" class="md:hidden focus:outline-none">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
         viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>
</header>

<!-- Mobile Slide-Out Menu -->
<div id="mobile-menu" class="fixed top-0 right-0 h-full w-64 bg-black text-white transform translate-x-full transition-transform duration-300 z-50">
  <div class="flex justify-end p-4">
    <button id="close-menu" class="text-white text-xl">&times;</button>
  </div>
  <nav class="flex flex-col items-start px-6 space-y-4 text-sm font-bold uppercase tracking-wide">
    <a href="#about" class="hover:text-gray-400 transition" onclick="toggleMenu()">About Us</a>
    <a href="contact.html" class="hover:text-gray-400 transition" onclick="toggleMenu()">Contact Us</a>
  </nav>
</div>

<!-- Overlay (optional for darker background when menu is open) -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40" onclick="toggleMenu()"></div>

  <!-- Sticky Hero Container -->
  <div class="sticky top-0 z-0 h-screen flex flex-col justify-center px-6 py-12 md:px-12 bg-black">
    <!-- Hero Section -->
    <h1 class="text-4xl md:text-6xl font-extrabold uppercase glitch leading-tight z-10">
      Born for Impact.<br />
      Built to <span class="dopamine-orange">Dominate</span>.
    </h1>
    <p class="mt-4 text-sm md:text-lg text-gray-400 max-w-md z-10">
      Built with edge. Backed by grit. Worn by the unbreakable.
    </p>
    <a href="#join" class="mt-8 dopamine-bg text-black font-bold text-xs md:text-sm px-5 py-3 tracking-widest hover:opacity-80 uppercase z-10 w-max">
      Enter the Arena →
    </a>
  </div>

  <!-- Scroll Content (starts over hero) -->
  <main class="relative z-10 bg-white text-black">

    <!-- Pattern Interrupt -->
    <section class="px-6 py-16 md:py-24 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      <div class="border-t-2 border-black pt-4">
        <h2 class="text-lg font-bold uppercase">No Rounds</h2>
        <p class="mt-2 text-sm">We’re carved. Not shaped.</p>
      </div>
      <div class="border-t-2 border-black pt-4">
        <h2 class="text-lg font-bold uppercase">Built for Heat</h2>
        <p class="mt-2 text-sm">Engineered to grip, breathe, and perform under pressure.</p>
      </div>
      <div class="border-t-2 border-black pt-4">
        <h2 class="text-lg font-bold uppercase">Never Passive</h2>
        <p class="mt-2 text-sm">We don’t do soft, subtle, or silent. Neither should you.</p>
      </div>
    </section>

    <!-- About Section -->

<section id="about" class="bg-black text-white px-6 py-16 md:py-24 text-center">

  <h2 class="text-3xl md:text-4xl font-bold uppercase mb-6">About BosGaurus</h2>

  <p class="max-w-3xl mx-auto text-sm md:text-lg text-gray-300">

    BosGaurus was born out of the need for fierce, performance-ready that don't just look good—they dominate. Designed for athletes, rebels, and relentless movers, our products are carved with purpose and crafted for power. Every step tells a story. Make yours unbreakable.

  </p>

</section>

 <!-- Community / Contact Section -->
<section id="join" class="bg-white text-black px-6 py-16 md:py-24 text-center">
  <h2 class="text-3xl font-bold uppercase mb-4">Bosverse is Coming</h2>
  <p class="text-sm md:text-lg mb-6 max-w-xl mx-auto">
    Not a club. A movement. No points. Just respect. Be the first in.
  </p>

  <form id="contact-form" class="flex flex-col gap-4 mt-6 max-w-xl mx-auto text-left">
    <input 
      type="text" 
      name="name"
      placeholder="Full Name" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase" 
      required
    />

    <input 
      type="tel" 
      name="phone"
      placeholder="Phone Number" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase" 
      required
    />

    <input 
      type="email" 
      name="email"
      placeholder="Email Address" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase" 
      required
    />

    <textarea 
      name="message"
      placeholder="Your Message / Query" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase h-32 resize-none"
      required
    ></textarea>

    <button 
      type="submit" 
      id="submit-button"
      class="dopamine-bg text-black px-6 py-3 font-bold uppercase tracking-wider hover:opacity-80 w-full sm:w-auto flex items-center justify-center"
    >
      Join Early
    </button>
  </form>

  <!-- Success Message -->
  <p id="success-msg" class="mt-4 text-green-600 font-bold hidden">Welcome to BosVerse</p>
</section>

<script>
  const form = document.getElementById("contact-form");
  const button = document.getElementById("submit-button");
  const successMsg = document.getElementById("success-msg");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const originalText = button.innerHTML;

    // Show spinner
    button.disabled = true;
    button.innerHTML = `
      <svg class="animate-spin h-5 w-5 mr-2 text-black inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"></path>
      </svg>
      Loading...
    `;

    const formData = {
      name: form.name.value,
      phone: form.phone.value,
      email: form.email.value,
      message: form.message.value,
    };

    fetch("https://script.google.com/macros/s/AKfycbz1RNmHXn00xghYwT0QBwDmPGD7Fk846jxEnRmLPUUc0kyRfKBH2l7crLB0NYO0HJEMPA/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData),
    })
      .then(res => res.json())
      .then(data => {
        button.disabled = false;
        button.innerHTML = originalText;

        if (data.result === "success") {
          successMsg.classList.remove("hidden");
          form.reset();
        } else {
          alert("Something went wrong. Try again!");
        }
      })
      .catch(err => {
        button.disabled = false;
        button.innerHTML = originalText;
        console.error("Error:", err);
        alert("Network error. Try again!");
      });
  });
</script>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const closeBtn = document.getElementById("close-menu");
  const mobileMenu = document.getElementById("mobile-menu");
  const overlay = document.getElementById("overlay");

  function toggleMenu() {
    mobileMenu.classList.toggle("translate-x-full");
    overlay.classList.toggle("hidden");
  }

  menuBtn.addEventListener("click", toggleMenu);
  closeBtn.addEventListener("click", toggleMenu);
</script>



    <!-- Footer -->
    <footer class="bg-black text-white text-center text-xs py-6 uppercase border-t border-white">
      &copy; 2025 Bos Gaurus. Stay Unbreakable.
    </footer>

  </main>
</body>
</html>

</html>





<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Voice Assistant Widget</title>
  <style>
    :root{
      --bg:#f2f6fb;
      --card:#ffffff;
      --ink:#0a1b2a;
      --muted:#5a6b7d;
      --accent:#0b6b8a; /* teal-blue */
      --accent-2:#3aa0ff; /* blue voice */
      --danger:#ef4444;
      --glass: rgba(230,233,238,0.9);
      --shadow: 0 10px 30px rgba(6,30,60,.08);
      --radius:16px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    html,body{background:var(--bg);margin:0;min-height:100%}

    /* ——— Floating Widget Button ——— */
    .va-widget{position:fixed;inset:auto 16px 16px auto;z-index:1000;display:flex;align-items:center;gap:10px;background:var(--card);border-radius:999px;padding:10px 12px;box-shadow:var(--shadow);border:1px solid rgba(0,0,0,.04)}
    .va-widget .avatar{width:36px;height:36px;border-radius:50%;overflow:hidden;border:1px solid rgba(0,0,0,.06)}
    .va-widget .title{font-weight:700;font-size:14px;color:var(--ink);line-height:1}
    .va-widget .sub{font-size:12px;color:var(--muted);margin-top:2px}
    .va-widget .cta{display:inline-flex;align-items:center;gap:8px;border:none;border-radius:999px;padding:10px 14px;background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;font-weight:700;cursor:pointer}
    .va-widget .cta[disabled]{opacity:.6;cursor:not-allowed}

    /* ——— Fullscreen Call Overlay ——— */
    .va-overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(255,255,255,.98),rgba(246,251,253,.98));display:none;align-items:center;justify-content:center;padding:18px;z-index:2000}
    .va-overlay.show{display:flex}
    .va-stage{width:100%;max-width:520px;background:var(--card);border-radius:20px;padding:20px 18px;box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center;border:1px solid rgba(0,0,0,.05)}

    /* ——— Voice Ring (animated) ——— */
    .ring{position:relative;width:min(84vw,360px);height:min(84vw,360px);border-radius:50%;display:grid;place-items:center;border:12px solid var(--glass);background:radial-gradient(100% 100% at 30% 30%, rgba(11,107,138,.15) 0%, transparent 40%),radial-gradient(100% 100% at 70% 70%, rgba(58,160,255,.12) 0%, transparent 42%)}
    .ring .pulse{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);border-radius:50%;filter:blur(16px);opacity:.18}
    .ring .p1{width:160%;height:160%;background:linear-gradient(90deg,var(--accent),var(--accent-2));animation:p1 2.3s ease-in-out infinite}
    .ring .p2{width:120%;height:120%;background:linear-gradient(90deg,var(--accent-2),#aee6ff);animation:p2 2.9s ease-in-out infinite}
    @keyframes p1{0%{transform:translate(-50%,-50%) scale(.92);opacity:.12}50%{transform:translate(-50%,-50%) scale(1);opacity:.24}100%{transform:translate(-50%,-50%) scale(.92);opacity:.12}}
    @keyframes p2{0%{transform:translate(-50%,-50%) scale(1);opacity:.08}50%{transform:translate(-50%,-50%) scale(1.06);opacity:.2}100%{transform:translate(-50%,-50%) scale(1);opacity:.08}}
    .spokes{position:absolute;inset:0}
    .spoke{position:absolute;left:50%;top:50%;transform-origin:0 0;width:6px;height:18%;background:linear-gradient(180deg,var(--accent-2),var(--accent));border-radius:4px;opacity:.85;animation:s 1.4s ease-in-out infinite}
    .spoke:nth-child(2n){animation-duration:1.1s}
    .spoke:nth-child(3n){animation-duration:1.6s}
    @keyframes s{0%{transform:scaleY(.5) translateX(-50%)}50%{transform:scaleY(1) translateX(-50%)}100%{transform:scaleY(.5) translateX(-50%)}}
    .center-pin{width:10px;height:10px;border-radius:50%;background:var(--accent-2);box-shadow:0 6px 18px rgba(10,40,80,.12)}

    .meta{margin-top:14px;display:flex;gap:10px;align-items:center}
    .pill{padding:8px 12px;border-radius:999px;background:#fff;border:1px solid rgba(0,0,0,.06);font-weight:600;color:var(--ink)}
    .subtle{color:var(--muted);font-weight:600}

    .controls{display:flex;gap:14px;margin-top:18px}
    .btn{width:56px;height:56px;border-radius:14px;border:1px solid rgba(0,0,0,.06);background:#f6fbff;display:grid;place-items:center;cursor:pointer;box-shadow:0 6px 18px rgba(6,30,60,.06)}
    .btn.end{background:linear-gradient(180deg,#ff6b6b,#ef4444);border:none}
    .btn svg{width:26px;height:26px}

    @media(min-width:760px){.va-widget{inset:auto 20px 20px auto}.va-stage{padding:28px}}
    @media (prefers-reduced-motion: reduce){*{animation:none!important}}
  </style>
</head>
<body>

  <!-- Floating Widget -->
  <div class="va-widget" id="vaWidget">
    <img class="avatar" alt="assistant" src="data:image/svg+xml;utf8,<?xml version='1.0' encoding='UTF-8'?><svg xmlns='http://www.w3.org/2000/svg' width='80' height='80'><defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'><stop offset='0' stop-color='%2372d0d9'/><stop offset='1' stop-color='%230b6b8a'/></linearGradient></defs><rect width='100%' height='100%' rx='40' fill='url(%23g)'/></svg>">
    <div style="min-width:0">
      <div class="title">Need help?</div>
      <div class="sub">Tap to speak with assistant</div>
    </div>
    <button class="cta" id="startBtn" aria-label="Start voice call">
      <!-- Headset Icon (Heroicons solid headset-microphone) -->
      <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="20" height="20"><path d="M12 2a8 8 0 0 0-8 8v3a3 3 0 0 0 3 3h1v-6H7a1 1 0 0 1-1-1 6 6 0 1 1 12 0 1 1 0 0 1-1 1h-1v6h1a3 3 0 0 0 3-3v-3a8 8 0 0 0-8-8z"/><path d="M9 14.5A2.5 2.5 0 0 0 11.5 17H13v1.25A2.75 2.75 0 0 1 10.25 21h-.5a.75.75 0 0 1 0-1.5h.5c.69 0 1.25-.56 1.25-1.25V17h-1.5A2.5 2.5 0 0 1 8 14.5V12h1v2.5z"/></svg>
      Talk
    </button>
  </div>

  <!-- Call Overlay -->
  <div class="va-overlay" id="vaOverlay" aria-hidden="true">
    <div class="va-stage" role="dialog" aria-modal="true">
      <div class="ring" id="ring">
        <div class="pulse p1"></div>
        <div class="pulse p2"></div>
        <div class="spokes" aria-hidden="true">
          <div class="spoke" style="transform:rotate(0deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(30deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(60deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(90deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(120deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(150deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(180deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(210deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(240deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(270deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(300deg) translateX(-50%)"></div>
          <div class="spoke" style="transform:rotate(330deg) translateX(-50%)"></div>
        </div>
        <div class="center-pin" aria-hidden="true"></div>
      </div>

      <div class="meta">
        <div class="pill" id="statusPill">Connecting…</div>
        <div class="subtle" id="timer">00:00</div>
      </div>

      <div class="controls">
        <!-- End Call (Heroicons phone-x-mark solid) -->
        <button class="btn end" id="endBtn" aria-label="End call" title="End call">
          <svg viewBox="0 0 24 24" fill="#fff" aria-hidden="true"><path d="M2.25 9.75a1.5 1.5 0 0 1 1-1.414c5.58-2.168 11.92-2.168 17.5 0a1.5 1.5 0 0 1 1 1.414v2.087a1.5 1.5 0 0 1-1.824 1.469l-3.38-.73a1.5 1.5 0 0 1-1.131-.92l-.59-1.476a19.6 19.6 0 0 0-4.95 0l-.59 1.476a1.5 1.5 0 0 1-1.13.92l-3.382.73A1.5 1.5 0 0 1 2.25 11.837V9.75z"/></svg>
        </button>
        <!-- Mute (toggles) Heroicons microphone/microphone-slash -->
        <button class="btn" id="muteBtn" aria-pressed="false" aria-label="Mute" title="Mute / Unmute">
          <svg id="micOn" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3z"/><path d="M5 11a1 1 0 1 1 2 0 5 5 0 1 0 10 0 1 1 0 1 1 2 0 7 7 0 0 1-6 6.93V21h3a1 1 0 1 1 0 2H10a1 1 0 1 1 0-2h3v-3.07A7 7 0 0 1 5 11z"/></svg>
          <svg id="micOff" style="display:none" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M3.28 2.22a.75.75 0 0 0-1.06 1.06l18.5 18.5a.75.75 0 1 0 1.06-1.06l-3.37-3.37A7.03 7.03 0 0 0 19 11a1 1 0 1 0-2 0 5 5 0 0 1-8.53 3.54l1.12-1.12A3 3 0 0 0 15 11V9.56L3.28 2.22z"/><path d="M12 2a3 3 0 0 0-3 3v1.19l6.01 3.6V5a3 3 0 0 0-3-3z"/><path d="M10 21a1 1 0 1 0 0 2h4a1 1 0 1 0 0-2h-1.99v-2.07a7 7 0 0 0 3.53-1.23l-1.17-1.17a5 5 0 0 1-6.73-.23l-1.13 1.13c.9.71 1.95 1.22 3.11 1.47V21H10z"/></svg>
        </button>
      </div>
    </div>
  </div>

<script>
(() => {
  // ——— Config (replace with your endpoints) ———
  const N8N_START_URL = 'http://localhost:5678/webhook-test/start-call'; // must return { sessionId, wsUrl }
  const N8N_END_URL   = 'http://localhost:5678/webhook-test/end-call';   // optional
  const USER_ID = 'user-123';

  // ——— Elements ———
  const widget = document.getElementById('vaWidget');
  const startBtn = document.getElementById('startBtn');
  const overlay = document.getElementById('vaOverlay');
  const statusPill = document.getElementById('statusPill');
  const timerEl = document.getElementById('timer');
  const endBtn = document.getElementById('endBtn');
  const muteBtn = document.getElementById('muteBtn');
  const micOn = document.getElementById('micOn');
  const micOff = document.getElementById('micOff');

  // ——— State ———
  let callActive = false;
  let muted = false;
  let sessionId = null;
  let ws = null;
  let mediaRecorder = null;
  let micStream = null;
  let audioContext = null;
  let audioQueue = [];
  let isPlaying = false;
  let startedAt = 0;
  let timerInterval = null;

  function showOverlay(){
    overlay.classList.add('show');
    overlay.setAttribute('aria-hidden','false');
  }
  function hideOverlay(){
    overlay.classList.remove('show');
    overlay.setAttribute('aria-hidden','true');
  }

  function formatTime(ms){
    const total = Math.floor(ms / 1000);
    const m = String(Math.floor(total / 60)).padStart(2,'0');
    const s = String(total % 60).padStart(2,'0');
    return `${m}:${s}`;
  }

  function startTimer(){
    startedAt = Date.now();
    timerEl.textContent = '00:00';
    timerInterval = setInterval(() => {
      timerEl.textContent = formatTime(Date.now() - startedAt);
    }, 1000);
  }
  function stopTimer(){
    clearInterval(timerInterval); timerInterval = null;
  }

  async function startCall(){
    if (N8N_START_URL.includes('YOUR-N8N-DOMAIN')){
      alert('Configure N8N_START_URL before using.');
      return;
    }
    startBtn.disabled = true;
    startBtn.textContent = 'Connecting…';
    statusPill.textContent = 'Initializing…';
    showOverlay();

    try{
      // Pre-create/resume audio context on user gesture for autoplay policies
      if (!audioContext){
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
      } else if (audioContext.state === 'suspended'){
        await audioContext.resume();
      }

      const res = await fetch(N8N_START_URL,{
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ userId: USER_ID })
      });
      if(!res.ok) throw new Error(`Start webhook failed: ${res.status}`);
      const data = await res.json();
      if(!data.sessionId || !data.wsUrl) throw new Error('Invalid start response: missing sessionId or wsUrl');
      sessionId = data.sessionId;
      statusPill.textContent = 'Requesting mic…';

      micStream = await navigator.mediaDevices.getUserMedia({ audio: true });

      // Mic capture as Opus (browser default) — your backend must decode it
      mediaRecorder = new MediaRecorder(micStream, { mimeType: 'audio/webm;codecs=opus' });

      ws = new WebSocket(data.wsUrl);
      ws.binaryType = 'arraybuffer';

      ws.onopen = () => {
        statusPill.textContent = 'Connected. You can talk';
        callActive = true;
        // start sending mic
        mediaRecorder.ondataavailable = (e) => {
          if (e.data && e.data.size > 0 && ws && ws.readyState === WebSocket.OPEN){
            ws.send(e.data);
          }
        };
        mediaRecorder.start(250); // 250ms chunks
        startTimer();
      };

      ws.onmessage = async (event) => {
        try{
          let buf;
          if (event.data instanceof ArrayBuffer){
            buf = event.data;
          } else if (event.data instanceof Blob){
            buf = await event.data.arrayBuffer();
          } else if (typeof event.data === 'string'){
            // If backend sends base64 audio strings
            const b = atob(event.data);
            const len = b.length; const arr = new Uint8Array(len);
            for(let i=0;i<len;i++) arr[i] = b.charCodeAt(i);
            buf = arr.buffer;
          }
          if (buf) {
            audioQueue.push(buf);
            if (!isPlaying) playNext();
          }
        } catch(err){
          console.error('onmessage error:', err);
        }
      };

      ws.onerror = (e) => {
        console.error('WebSocket error', e);
        statusPill.textContent = 'Connection error';
      };

      ws.onclose = () => {
        if (callActive) endCall(false);
      };

    } catch(err){
      console.error(err);
      statusPill.textContent = `Error: ${err.message}`;
      setTimeout(() => { endCall(false); }, 2000);
    } finally {
      startBtn.disabled = false;
      startBtn.textContent = 'Talk';
    }
  }

  async function playNext(){
    if (!audioQueue.length){ isPlaying = false; return; }
    isPlaying = true;
    try{
      const buf = audioQueue.shift();
      // Decode (expecting audio/mpeg or audio/wav payloads)
      const audioBuffer = await audioContext.decodeAudioData(buf.slice(0));
      const src = audioContext.createBufferSource();
      src.buffer = audioBuffer; src.connect(audioContext.destination);
      src.onended = () => playNext();
      src.start();
      statusPill.textContent = 'Speaking…';
    } catch(err){
      console.warn('Decode failed, skipping chunk', err);
      // Try the next chunk
      playNext();
    }
  }

  function toggleMute(){
    muted = !muted;
    muteBtn.setAttribute('aria-pressed', String(muted));
    micOn.style.display = muted ? 'none' : '';
    micOff.style.display = muted ? '' : 'none';
    if (micStream){
      micStream.getAudioTracks().forEach(t => t.enabled = !muted);
    }
    // Optional: notify backend
    // fetch('https://YOUR-N8N-DOMAIN/webhook/mute', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ sessionId, muted })}).catch(()=>{});
  }

  function endCall(userInitiated = true){
    callActive = false;
    stopTimer();
    statusPill.textContent = userInitiated ? 'Call ended' : 'Disconnected';

    try{ if (mediaRecorder && mediaRecorder.state !== 'inactive') mediaRecorder.stop(); }catch{}
    try{ if (micStream) micStream.getTracks().forEach(t => t.stop()); }catch{}
    try{ if (ws && ws.readyState === WebSocket.OPEN) ws.close(1000,'client-end'); }catch{}

    // Clear playback state
    audioQueue = []; isPlaying = false;

    if (audioContext && audioContext.state !== 'closed'){
      // keep context alive to avoid warm-up on next connect
    }
    if (sessionId && N8N_END_URL && !N8N_END_URL.includes('YOUR-N8N-DOMAIN')){
      fetch(N8N_END_URL,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({sessionId})}).catch(()=>{});
    }

    // Close UI after a short delay
    setTimeout(() => { hideOverlay(); }, 500);
  }

  // ——— Events ———
  startBtn.addEventListener('click', startCall);
  endBtn.addEventListener('click', () => endCall(true));
  muteBtn.addEventListener('click', toggleMute);

  // Escape closes overlay
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && overlay.classList.contains('show')) endCall(true); });
})();
</script>
</body>
</html>
