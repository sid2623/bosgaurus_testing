<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta name="description" content="Bos Gaurus - Built for Impact. Gear for athletes, rebels, and relentless movers. Enter the BosVerse.">
<meta property="og:title" content="Bos Gaurus">
  <meta property="og:image" content="Adobe Express - file.png">

<meta property="og:description" content="Born for Impact. Built to Dominate.">
<meta property="og:type" content="website">

  <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<meta name="apple-mobile-web-app-title" content="BOS" />
<link rel="manifest" href="/site.webmanifest" />

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bos Gaurus</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .dopamine-orange {
      color: #ED944D;
    }
    .dopamine-bg {
      background-color: #ED944D;
    }
    .no-radius * {
      border-radius: 0 !important;
    }

    /* Glitch Animation */
    .glitch {
      position: relative;
      color: white;
      animation: glitch 1s infinite;
    }

    @keyframes glitch {
      0% {text-shadow: 2px 2px #ED944D;}
      20% {text-shadow: -2px -2px #ED944D;}
      40% {text-shadow: 2px -2px #ED944D;}
      60% {text-shadow: -2px 2px #ED944D;}
      80% {text-shadow: 1px 1px #ED944D;}
      100% {text-shadow: 0 0 #ED944D;}
    }
  </style>
</head>

<body class="bg-black text-white font-mono no-radius">
     
<!-- Navigation Header -->
<header class="bg-white text-black px-6 py-4 flex justify-between items-center sticky top-0 z-50 border-b border-gray-700">
  <!-- Logo -->
  <div class="flex items-center">
    <img src="Adobe Express - file.png" alt="Bos Gaurus Logo" class="h-8 w-auto mr-2">
  </div>

  <!-- Desktop Navigation -->
  <nav class="hidden md:flex space-x-6 text-sm font-bold uppercase tracking-wide">
    <a href="#about" class="hover:text-gray-400 transition">About Us</a>
    <a href="contact.html" class="hover:text-gray-400 transition">Contact Us</a>
  </nav>

  <!-- Hamburger Menu Button (Mobile only) -->
  <button id="menu-btn" class="md:hidden focus:outline-none">
    <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2"
         viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round">
      <path d="M4 6h16M4 12h16M4 18h16" />
    </svg>
  </button>
</header>

<!-- Mobile Slide-Out Menu -->
<div id="mobile-menu" class="fixed top-0 right-0 h-full w-64 bg-black text-white transform translate-x-full transition-transform duration-300 z-50">
  <div class="flex justify-end p-4">
    <button id="close-menu" class="text-white text-xl">&times;</button>
  </div>
  <nav class="flex flex-col items-start px-6 space-y-4 text-sm font-bold uppercase tracking-wide">
    <a href="#about" class="hover:text-gray-400 transition" onclick="toggleMenu()">About Us</a>
    <a href="contact.html" class="hover:text-gray-400 transition" onclick="toggleMenu()">Contact Us</a>
  </nav>
</div>

<!-- Overlay (optional for darker background when menu is open) -->
<div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40" onclick="toggleMenu()"></div>

  <!-- Sticky Hero Container -->
  <div class="sticky top-0 z-0 h-screen flex flex-col justify-center px-6 py-12 md:px-12 bg-black">
    <!-- Hero Section -->
    <h1 class="text-4xl md:text-6xl font-extrabold uppercase glitch leading-tight z-10">
      Born for Impact.<br />
      Built to <span class="dopamine-orange">Dominate</span>.
    </h1>
    <p class="mt-4 text-sm md:text-lg text-gray-400 max-w-md z-10">
      Built with edge. Backed by grit. Worn by the unbreakable.
    </p>
    <a href="#join" class="mt-8 dopamine-bg text-black font-bold text-xs md:text-sm px-5 py-3 tracking-widest hover:opacity-80 uppercase z-10 w-max">
      Enter the Arena →
    </a>
  </div>

  <!-- Scroll Content (starts over hero) -->
  <main class="relative z-10 bg-white text-black">

    <!-- Pattern Interrupt -->
    <section class="px-6 py-16 md:py-24 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      <div class="border-t-2 border-black pt-4">
        <h2 class="text-lg font-bold uppercase">No Rounds</h2>
        <p class="mt-2 text-sm">We’re carved. Not shaped.</p>
      </div>
      <div class="border-t-2 border-black pt-4">
        <h2 class="text-lg font-bold uppercase">Built for Heat</h2>
        <p class="mt-2 text-sm">Engineered to grip, breathe, and perform under pressure.</p>
      </div>
      <div class="border-t-2 border-black pt-4">
        <h2 class="text-lg font-bold uppercase">Never Passive</h2>
        <p class="mt-2 text-sm">We don’t do soft, subtle, or silent. Neither should you.</p>
      </div>
    </section>

    <!-- About Section -->

<section id="about" class="bg-black text-white px-6 py-16 md:py-24 text-center">

  <h2 class="text-3xl md:text-4xl font-bold uppercase mb-6">About BosGaurus</h2>

  <p class="max-w-3xl mx-auto text-sm md:text-lg text-gray-300">

    BosGaurus was born out of the need for fierce, performance-ready that don't just look good—they dominate. Designed for athletes, rebels, and relentless movers, our products are carved with purpose and crafted for power. Every step tells a story. Make yours unbreakable.

  </p>

</section>

 <!-- Community / Contact Section -->
<section id="join" class="bg-white text-black px-6 py-16 md:py-24 text-center">
  <h2 class="text-3xl font-bold uppercase mb-4">Bosverse is Coming</h2>
  <p class="text-sm md:text-lg mb-6 max-w-xl mx-auto">
    Not a club. A movement. No points. Just respect. Be the first in.
  </p>

  <form id="contact-form" class="flex flex-col gap-4 mt-6 max-w-xl mx-auto text-left">
    <input 
      type="text" 
      name="name"
      placeholder="Full Name" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase" 
      required
    />

    <input 
      type="tel" 
      name="phone"
      placeholder="Phone Number" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase" 
      required
    />

    <input 
      type="email" 
      name="email"
      placeholder="Email Address" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase" 
      required
    />

    <textarea 
      name="message"
      placeholder="Your Message / Query" 
      class="px-4 py-3 border border-black w-full text-sm tracking-wide uppercase h-32 resize-none"
      required
    ></textarea>

    <button 
      type="submit" 
      id="submit-button"
      class="dopamine-bg text-black px-6 py-3 font-bold uppercase tracking-wider hover:opacity-80 w-full sm:w-auto flex items-center justify-center"
    >
      Join Early
    </button>
  </form>

  <!-- Success Message -->
  <p id="success-msg" class="mt-4 text-green-600 font-bold hidden">Welcome to BosVerse</p>
</section>

<script>
  const form = document.getElementById("contact-form");
  const button = document.getElementById("submit-button");
  const successMsg = document.getElementById("success-msg");

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const originalText = button.innerHTML;

    // Show spinner
    button.disabled = true;
    button.innerHTML = `
      <svg class="animate-spin h-5 w-5 mr-2 text-black inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4l3.5-3.5L12 0v4a8 8 0 100 16v4l3.5-3.5L12 20v-4a8 8 0 01-8-8z"></path>
      </svg>
      Loading...
    `;

    const formData = {
      name: form.name.value,
      phone: form.phone.value,
      email: form.email.value,
      message: form.message.value,
    };

    fetch("https://script.google.com/macros/s/AKfycbz1RNmHXn00xghYwT0QBwDmPGD7Fk846jxEnRmLPUUc0kyRfKBH2l7crLB0NYO0HJEMPA/exec", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(formData),
    })
      .then(res => res.json())
      .then(data => {
        button.disabled = false;
        button.innerHTML = originalText;

        if (data.result === "success") {
          successMsg.classList.remove("hidden");
          form.reset();
        } else {
          alert("Something went wrong. Try again!");
        }
      })
      .catch(err => {
        button.disabled = false;
        button.innerHTML = originalText;
        console.error("Error:", err);
        alert("Network error. Try again!");
      });
  });
</script>

<script>
  const menuBtn = document.getElementById("menu-btn");
  const closeBtn = document.getElementById("close-menu");
  const mobileMenu = document.getElementById("mobile-menu");
  const overlay = document.getElementById("overlay");

  function toggleMenu() {
    mobileMenu.classList.toggle("translate-x-full");
    overlay.classList.toggle("hidden");
  }

  menuBtn.addEventListener("click", toggleMenu);
  closeBtn.addEventListener("click", toggleMenu);
</script>



    <!-- Footer -->
    <footer class="bg-black text-white text-center text-xs py-6 uppercase border-t border-white">
      &copy; 2025 Bos Gaurus. Stay Unbreakable.
    </footer>

  </main>
</body>
</html>






<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Interactive Call Widget</title>
  <style>
    :root{
      --accent-1:#0b6b8a; /* teal-blue */
      --accent-2:#3aa0ff; /* blue voice */
      --bg:#ffffff;
      --shadow: 0 8px 30px rgba(6,30,60,0.08);
      --glass: rgba(230,233,238,0.95);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }
    body {
      background-color: #f0f4f8;
      margin: 0;
      min-height: 100vh;
    }
    /* MOBILE-FIRST WIDGET */
    .call-widget{
      position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:9999;
      width:calc(100% - 36px);max-width:720px;background:linear-gradient(180deg,#fff,#fbfdff);
      border-radius:14px;padding:10px 12px;box-shadow:var(--shadow);display:flex;align-items:center;gap:12px
    }
    .call-widget .avatar{width:44px;height:44px;border-radius:50%;overflow:hidden;border:1px solid rgba(0,0,0,0.04);flex:0 0 44px}
    .call-widget .avatar img{width:100%;height:100%;object-fit:cover}
    .call-widget .text{flex:1;min-width:0}
    .call-widget .title{font-weight:700;font-size:15px;color:#072033}
    .call-widget .sub{font-size:13px;color:#546377;margin-top:2px}
    .call-widget .cta{background:#000;color:#fff;border-radius:999px;padding:10px 14px;font-weight:700;border:none;display:inline-flex;align-items:center;gap:10px; cursor: pointer; transition: background-color 0.2s ease;}
    .call-widget .cta:disabled { background-color: #555; cursor: not-allowed; }
    .call-widget .phone-icon{width:18px;height:18px;display:inline-block}
    /* FULLSCREEN / PANEL (mobile-optimised) */
    .call-overlay{position:fixed;inset:0;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(248,251,253,0.98));display:none;align-items:center;justify-content:center;padding:18px;z-index:10000}
    .call-overlay.show{display:flex}
    .call-stage{width:100%;max-width:460px;border-radius:18px;padding:18px;background:linear-gradient(180deg,#fff,#f6fbfd);box-shadow:var(--shadow);display:flex;flex-direction:column;align-items:center}
    /* Voice-mode ring (animated like ChatGPT voice) */
    .ring{position:relative;width:84vw;max-width:340px;height:84vw;max-height:340px;border-radius:50%;overflow:hidden;border:12px solid rgba(230,233,238,0.95);display:flex;align-items:center;justify-content:center;background:radial-gradient(circle at 35% 30%, rgba(11,107,138,0.18), transparent 20%), radial-gradient(circle at 70% 70%, rgba(58,160,255,0.12), transparent 22%)}
    .ring .pulse{position:absolute;border-radius:50%;transform:translate(-50%,-50%);left:50%;top:50%;opacity:0.18;filter:blur(18px);}
    .ring .pulse.p1{width:160%;height:160%;background:linear-gradient(90deg,var(--accent-1),var(--accent-2));animation:pulseA 2.2s ease-in-out infinite}
    .ring .pulse.p2{width:120%;height:120%;background:linear-gradient(90deg,var(--accent-2),#aee6ff);animation:pulseB 2.8s ease-in-out infinite}
    @keyframes pulseA{0%{transform:translate(-50%,-50%) scale(0.9);opacity:0.12}50%{transform:translate(-50%,-50%) scale(1);opacity:0.24}100%{transform:translate(-50%,-50%) scale(0.9);opacity:0.12}}
    @keyframes pulseB{0%{transform:translate(-50%,-50%) scale(1);opacity:0.09}50%{transform:translate(-50%,-50%) scale(1.06);opacity:0.22}100%{transform:translate(-50%,-50%) scale(1);opacity:0.09}}
    .spokes{position:absolute;inset:0;display:block}
    .spoke{position:absolute;left:50%;top:50%;transform-origin:0 0;width:6px;height:18%;background:linear-gradient(180deg,var(--accent-2),var(--accent-1));border-radius:4px;opacity:0.85}
    .spoke:nth-child(1){transform:rotate(0deg) translateX(-50%);} .spoke:nth-child(2){transform:rotate(30deg) translateX(-50%);} .spoke:nth-child(3){transform:rotate(60deg) translateX(-50%);} .spoke:nth-child(4){transform:rotate(90deg) translateX(-50%);} .spoke:nth-child(5){transform:rotate(120deg) translateX(-50%);} .spoke:nth-child(6){transform:rotate(150deg) translateX(-50%);} .spoke:nth-child(7){transform:rotate(180deg) translateX(-50%);} .spoke:nth-child(8){transform:rotate(210deg) translateX(-50%);} .spoke:nth-child(9){transform:rotate(240deg) translateX(-50%);} .spoke:nth-child(10){transform:rotate(270deg) translateX(-50%);} .spoke:nth-child(11){transform:rotate(300deg) translateX(-50%);} .spoke:nth-child(12){transform:rotate(330deg) translateX(-50%);}
    .spoke{animation:spokeAnim 1.4s ease-in-out infinite}
    .spoke:nth-child(even){animation-duration:1.1s}
    .spoke:nth-child(3n){animation-duration:1.6s}
    @keyframes spokeAnim{0%{transform:scaleY(0.5) translateX(-50%)}50%{transform:scaleY(1.0) translateX(-50%)}100%{transform:scaleY(0.5) translateX(-50%)}}
    .blob{position:absolute;width:46%;height:46%;border-radius:50%;left:28%;top:28%;filter:blur(18px);background:radial-gradient(circle at 30% 30%, rgba(58,160,255,0.95), rgba(11,107,138,0.75));animation:blobMove 3.2s ease-in-out infinite}
    @keyframes blobMove{0%{transform:translate(0,0) scale(1)}33%{transform:translate(10px,-8px) scale(1.05)}66%{transform:translate(-8px,12px) scale(0.95)}100%{transform:translate(0,0) scale(1)}}
    .center-pin{width:8px;height:8px;border-radius:50%;background:var(--accent-2);position:relative;z-index:4;box-shadow:0 6px 18px rgba(10,40,80,0.12)}
    .talk-pill{margin-top:14px;padding:10px 16px;border-radius:0px;background:#fff;border:1px solid rgba(10,20,30,0.04);font-weight:700}
    .controls{display:flex;gap:14px;margin-top:18px;align-items:center}
    .icon-btn{width:52px;height:52px;border-radius:12px;border:none;background:#f7fbff;display:inline-grid;place-items:center;cursor:pointer;box-shadow:0 4px 14px rgba(6,30,60,0.06)}
    .icon-btn.end{background:linear-gradient(180deg,#ff5a50,#ff2d2a);color:#fff}
    @media (prefers-reduced-motion: reduce){*{animation:none!important}}
    @media(min-width:720px){
      .call-widget{width:320px;right:20px;left:auto;transform:none;border-radius:18px}
      .call-stage{max-width:520px}
    }
  </style>
</head>
<body>

<!-- MOBILE-FIRST WIDGET -->
<div class="call-widget" id="callWidget">
  <div class="avatar"><img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='120' height='120'><defs><linearGradient id='g' x1='0' x2='1' y1='0' y2='1'><stop offset='0' stop-color='%2372d0d9'/><stop offset='1' stop-color='%230b6b8a'/></linearGradient></defs><rect width='100%' height='100%' fill='url(%23g)' rx='60'/></svg>" alt="avatar"></div>
  <div class="text">
    <div class="title">Need help?</div>
    <div class="sub">Tap to start a quick voice assistant</div>
  </div>
  <button class="cta" id="startBtn" aria-label="Start call">
    <svg class="phone-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 16.5v3a1.5 1.5 0 0 1-1.65 1.493C16.99 21.03 10.97 18 6.507 13.53 2.03 9.05 0 3.03 0 1.65A1.5 1.5 0 0 1 1.493 0h3A1.5 1.5 0 0 1 6 1.493c0 .27.033.538.098.797.246 1.02 1.02 2.95 3.19 5.12 2.17 2.17 4.1 2.94 5.12 3.19.26.066.527.099.797.099A1.5 1.5 0 0 1 17.507 12h3A1.5 1.5 0 0 1 22 13.493v3z" fill="#fff"/></svg>
    Start
  </button>
</div>

<!-- CALL OVERLAY -->
<div class="call-overlay" id="callOverlay" aria-hidden="true">
  <div class="call-stage" role="dialog" aria-modal="true">
    <div class="ring" id="ring">
      <div class="pulse p1"></div>
      <div class="pulse p2"></div>
      <div class="spokes" aria-hidden="true">
        <div class="spoke"></div><div class="spoke"></div><div class="spoke"></div><div class="spoke"></div>
        <div class="spoke"></div><div class="spoke"></div><div class="spoke"></div><div class="spoke"></div>
        <div class="spoke"></div><div class="spoke"></div><div class="spoke"></div><div class="spoke"></div>
      </div>
      <div class="blob" aria-hidden="true"></div>
      <div class="center-pin" aria-hidden="true"></div>
    </div>

    <div class="talk-pill" id="talkPill">Connecting...</div>

    <div class="controls">
      <button class="icon-btn end" id="endBtn" aria-label="End call">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 16.5v3a1.5 1.5 0 0 1-1.65 1.493C16.99 21.03 10.97 18 6.507 13.53 2.03 9.05 0 3.03 0 1.65A1.5 1.5 0 0 1 1.493 0h3A1.5 1.5 0 0 1 6 1.493c0 .27.033.538.098.797.246 1.02 1.02 2.95 3.19 5.12 2.17 2.17 4.1 2.94 5.12 3.19.26.066.527.099.797.099A1.5 1.5 0 0 1 17.507 12h3A1.5 1.5 0 0 1 22 13.493v3z" fill="#fff"/></svg>
      </button>

      <button class="icon-btn" id="muteBtn" aria-pressed="false" aria-label="Mute">
        <svg id="muteIcon" width="22" height="22" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10v4h4l5 4V6L9 10H5z" fill="#072033"/></svg>
      </button>

      <div style="width:8px"></div>
    </div>
  </div>
</div>

<script>
  // --- UI Elements and State ---
  const startBtn = document.getElementById('startBtn');
  const callOverlay = document.getElementById('callOverlay');
  const endBtn = document.getElementById('endBtn');
  const muteBtn = document.getElementById('muteBtn');
  const muteIcon = document.getElementById('muteIcon');
  const ring = document.getElementById('ring');
  const talkPill = document.getElementById('talkPill');

  let callActive = false;
  let muted = false;
  let currentSessionId = null;

  // --- Real-time Audio Handling Globals ---
  let socket;
  let mediaRecorder;
  let audioContext;
  let audioQueue = [];
  let isPlaying = false;
  
  // --- UI Functions ---
  function showCallUI() {
    callOverlay.classList.add('show');
    callOverlay.setAttribute('aria-hidden', 'false');
    callActive = true;
    onCallStart(); 
  }

  function hideCallUI() {
    callOverlay.classList.remove('show');
    callOverlay.setAttribute('aria-hidden', 'true');
    callActive = false;
    onCallEnd();
  }

  // --- Event Listeners ---
  startBtn.addEventListener('click', showCallUI);
  endBtn.addEventListener('click', hideCallUI);

  muteBtn.addEventListener('click', () => {
    muted = !muted;
    muteBtn.setAttribute('aria-pressed', String(muted));
    if (mediaRecorder && mediaRecorder.stream) {
        mediaRecorder.stream.getAudioTracks().forEach(track => track.enabled = !muted);
    }
    // Visual feedback for mute can be added here

    // ==================================================================
    // 3. N8N WEBHOOK FOR MUTE/UNMUTE (Optional)
    // You can add a webhook call here to notify your n8n backend
    // whenever the user mutes or unmutes their microphone. This is
    // useful for logging or analytics.
    // ==================================================================
    /*
    fetch('YOUR_N8N_MUTE_WEBHOOK_URL_HERE', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        sessionId: currentSessionId,
        muted: muted 
      })
    }).catch(err => console.error('Mute webhook failed:', err));
    */
  });

  // --- n8n Webhook Integration ---
  async function onCallStart() {
    startBtn.disabled = true;
    startBtn.innerHTML = 'Connecting...';
    talkPill.textContent = 'Initializing Session...';

    // ==================================================================
    // 1. N8N WEBHOOK FOR START CALL
    // This is the primary webhook that initiates the entire session.
    // Replace the placeholder URL with your actual n8n "Start Call"
    // webhook URL (e.g., from ngrok).
    // ==================================================================
    const startCallUrl = 'https://nonevilly-psychogenetic-genie.ngrok-free.dev/webhook-test/start-call';

    // NEW: Check to prevent running with the placeholder URL.
    if (startCallUrl.includes('YOUR_N8N_START_CALL_WEBHOOK_URL_HERE')) {
      talkPill.textContent = 'Error: Configure Webhook URL';
      console.error("CRITICAL: You must replace 'YOUR_N8N_START_CALL_WEBHOOK_URL_HERE' in the script.");
      setTimeout(hideCallUI, 4000); // Give user time to see the error
      return; // Stop execution
    }

    try {
      const response = await fetch(startCallUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ userId: 'user-123' })
      });
      if (!response.ok) throw new Error(`Webhook handshake failed: ${response.status}`);
      
      const data = await response.json();
      talkPill.textContent = 'Session created. Connecting...';

      // NEW: The n8n workflow MUST return a sessionId and a wsUrl.
      if (data.sessionId && data.wsUrl) {
        currentSessionId = data.sessionId;
        // The wsUrl should be provided by your n8n workflow.
        // Example: "wss://your-ngrok-id.ngrok-free.app/webhook-ws/some-session-id"
        initializeAudio(data.wsUrl);
      } else {
        // NEW: Throw a specific error if the response from n8n is missing required data.
        throw new Error("Invalid response from n8n: Missing sessionId or wsUrl.");
      }

    } catch (err) {
      console.error('Error starting call:', err);
      // NEW: Display the actual error to the user for easier debugging.
      talkPill.textContent = `Error: ${err.message}`;
      setTimeout(hideCallUI, 4000); // Give user time to see the error
    } finally {
        startBtn.disabled = false;
        startBtn.innerHTML = `<svg class="phone-icon" viewBox="0 0 24 24" width="18" height="18" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 16.5v3a1.5 1.5 0 0 1-1.65 1.493C16.99 21.03 10.97 18 6.507 13.53 2.03 9.05 0 3.03 0 1.65A1.5 1.5 0 0 1 1.493 0h3A1.5 1.5 0 0 1 6 1.493c0 .27.033.538.098.797.246 1.02 1.02 2.95 3.19 5.12 2.17 2.17 4.1 2.94 5.12 3.19.26.066.527.099.797.099A1.5 1.5 0 0 1 17.507 12h3A1.5 1.5 0 0 1 22 13.493v3z" fill="#fff"/></svg> Start`;
    }
  }

  function onCallEnd() {
    // Stop microphone and WebSocket
    if (mediaRecorder && mediaRecorder.state === "recording") {
        mediaRecorder.stop();
    }
    if (socket && socket.readyState === WebSocket.OPEN) {
        socket.close();
    }
    if(audioContext) {
        audioContext.close();
    }
    talkPill.textContent = 'Call Ended';

    // ==================================================================
    // 2. N8N WEBHOOK FOR END CALL
    // It's good practice to notify your backend when the call has ended.
    // This allows you to clean up resources or finalize logs.
    // Uncomment the code below and add your "End Call" webhook URL.
    // ==================================================================
    /*
    if (currentSessionId) {
      fetch('YOUR_N8N_END_CALL_WEBHOOK_URL_HERE', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sessionId: currentSessionId })
      }).catch(err => console.error('End call webhook failed:', err));
    }
    */
  }

  // --- Real-Time Audio (WebSockets & Web Audio API) ---
  async function initializeAudio(wsUrl) {
    try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        
        socket = new WebSocket(wsUrl);
        socket.binaryType = 'arraybuffer';

        socket.onopen = () => {
            console.log("WebSocket connected. Starting microphone.");
            talkPill.textContent = 'You can talk now';
            mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm;codecs=opus' });
            
            mediaRecorder.ondataavailable = event => {
                if (event.data.size > 0 && socket.readyState === WebSocket.OPEN) {
                    socket.send(event.data);
                }
            };
            
            mediaRecorder.start(250); // Send data every 250ms
        };

        socket.onmessage = (event) => {
            // Assume server sends back audio data (e.g., base64 encoded or raw buffer)
            const audioData = event.data;
            audioQueue.push(audioData);
            if (!isPlaying) {
                playNextAudioChunk();
            }
        };

        socket.onclose = () => {
            console.log("WebSocket disconnected.");
            if (callActive) hideCallUI();
        };

        socket.onerror = (error) => {
            console.error("WebSocket error:", error);
            talkPill.textContent = 'Connection Error';
        };

    } catch (err) {
        console.error("Error accessing microphone:", err);
        talkPill.textContent = 'Microphone access denied.';
    }
  }

  async function playNextAudioChunk() {
    if (audioQueue.length === 0) {
        isPlaying = false;
        return;
    }
    isPlaying = true;

    if (!audioContext) {
        audioContext = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    const audioData = audioQueue.shift();
    try {
        // The server must send audio in a format the browser can decode, like WAV or MP3.
        // The ArrayBuffer received from the WebSocket is decoded here.
        const audioBuffer = await audioContext.decodeAudioData(audioData);
        const source = audioContext.createBufferSource();
        source.buffer = audioBuffer;
        source.connect(audioContext.destination);
        source.onended = playNextAudioChunk; // Play the next chunk when this one finishes
        source.start();
        talkPill.textContent = '...'; // AI is speaking
    } catch (e) {
        console.error("Error decoding audio data:", e);
        isPlaying = false; // Try to recover by playing the next chunk
        playNextAudioChunk();
    }
  }
</script>

</body>
</html>


</html>



